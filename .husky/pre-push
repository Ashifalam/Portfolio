#!/bin/sh

echo "ğŸ” Running pre-push quality checks..."

# ESLint check
echo "ğŸ“‹ Running ESLint..."
ESLINT_OUTPUT=$(npm run lint 2>&1)

if echo "$ESLINT_OUTPUT" | grep -q "âœ–"; then
  ERROR_COUNT=$(echo "$ESLINT_OUTPUT" | grep "âœ–" | grep -o "[0-9]\+ problems" | grep -o "[0-9]\+")
  if [ -z "$ERROR_COUNT" ]; then
    ERROR_COUNT=0
  fi
else
  ERROR_COUNT=0
fi

echo "$ESLINT_OUTPUT"
echo "ğŸ“Š Found $ERROR_COUNT ESLint errors"

if [ "$ERROR_COUNT" -gt 0 ]; then
  echo "âŒ ESLint errors found. Please fix them before pushing."
  echo "ğŸ’¡ Run 'npm run lint:fix' to automatically fix some issues."
  exit 1
else
  echo "âœ… No ESLint errors found."
fi

# Prettier check
echo "ğŸ¨ Checking code formatting with Prettier..."
npm run format:check
if [ $? -ne 0 ]; then
  echo "âŒ Prettier formatting issues found. Run 'npm run format' to fix."
  exit 1
else
  echo "âœ… Code formatting is correct."
fi

# Build
echo "ğŸ—ï¸ Building project..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build failed. Fix the issues before pushing."
  exit 1
else
  echo "âœ… Build successful."
fi

echo "âœ… All checks passed. Ready to push! ğŸš€"
